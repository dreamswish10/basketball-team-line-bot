# 群組別名功能使用範例

新的別名系統支援多種匹配模式，讓相似的別名能夠自動識別為同一用戶。

## 🎯 問題解決

**原始需求：** 「123金」、「234金」、「567金」等都要能識別為「金毛」用戶

**解決方案：** 使用模式匹配和正則表達式來實現群組別名

## 📚 使用格式

### 新的別名格式

```python
user_aliases = {
    "exact": ["精確別名1", "精確別名2"],      # 完全匹配
    "patterns": ["*通配符*", "開頭*"],        # 通配符匹配
    "regex": [r"\d+後綴", r"前綴\d+"]        # 正則表達式匹配
}
```

## 🌟 實際範例

### 範例 1: 金毛用戶
```python
"U金毛用戶的真實ID": {
    "exact": ["金毛", "小金"],
    "patterns": ["*金", "金*"],
    "regex": [r"\d+金", r"金\d+"]
}
```

**匹配結果：**
- ✅ `金毛` → 精確匹配
- ✅ `小金` → 精確匹配  
- ✅ `123金` → 正則匹配 `\d+金`
- ✅ `456金` → 正則匹配 `\d+金`
- ✅ `金789` → 正則匹配 `金\d+`
- ✅ `大金王` → 模式匹配 `*金`
- ✅ `金光閃閃` → 模式匹配 `金*`
- ✅ `超級金毛王` → 模式匹配 `*金*`

### 範例 2: 多用戶設定
```python
hardcoded_aliases = {
    "U實際用戶ID1": {
        "exact": ["金毛", "小金"],
        "patterns": ["*金*"],
        "regex": [r"\d+金", r"金\d+"]
    },
    "U實際用戶ID2": {
        "exact": ["銀毛", "小銀"],
        "patterns": ["*銀*"],
        "regex": [r"\d+銀", r"銀\d+"]
    },
    "U實際用戶ID3": {
        "exact": ["阿明", "小明"],
        "patterns": ["*明*", "明*"],
        "regex": [r"明\d+", r"\d+明"]
    }
}
```

## 🔍 匹配優先級

系統會按以下順序進行匹配：

1. **精確匹配 (exact)** - 最高優先級
2. **模式匹配 (patterns)** - 使用 `*` 通配符
3. **正則匹配 (regex)** - 正則表達式
4. **模糊匹配** - 向後兼容，包含匹配

## 📝 實際設定步驟

### 1. 獲取真實的 LINE User ID

在 LINE Bot 收到訊息時記錄：
```python
user_id = event.source.user_id  # 形如 "U1a2b3c4d5e6f7g8h9i0j1k2l3m4n5o6p"
print(f"用戶ID: {user_id}")
```

### 2. 更新 app.py 中的別名設定

```python
# 在 app.py 的 hardcoded_aliases 中設定
hardcoded_aliases = {
    "U真實的用戶ID": {  # 替換為步驟1獲得的真實ID
        "exact": ["金毛", "小金"],
        "patterns": ["*金*"],
        "regex": [r"\d+金", r"金\d+"]
    },
    # 更多用戶...
}
```

### 3. 部署到 Render

推送代碼到 Git，Render 會自動重新部署，新的別名設定會在服務啟動時自動生效。

## 🧪 本地測試

運行測試腳本來驗證設定：

```bash
python test_alias_setup.py
```

測試內容包括：
- 基本別名功能
- 硬編碼別名設定
- 模式匹配功能
- 各種匹配優先級

## 🎨 通配符說明

### `*` 通配符用法
- `*金` → 匹配任何以「金」結尾的文字
- `金*` → 匹配任何以「金」開頭的文字  
- `*金*` → 匹配任何包含「金」的文字

### 正則表達式範例
- `\d+金` → 匹配「數字+金」如「123金」
- `金\d+` → 匹配「金+數字」如「金456」
- `\d+金\d+` → 匹配「數字+金+數字」如「123金456」

## 📈 性能優化

系統會按優先級順序搜索，精確匹配最快，正則匹配相對較慢。建議：

1. 常用的確切別名放在 `exact` 中
2. 簡單的前後綴放在 `patterns` 中  
3. 複雜的模式放在 `regex` 中

## 🔄 向後兼容

系統完全向後兼容舊格式：

```python
# 舊格式（仍然支援）
"U用戶ID": ["別名1", "別名2", "別名3"]

# 新格式
"U用戶ID": {
    "exact": ["別名1", "別名2", "別名3"],
    "patterns": [],
    "regex": []
}
```

## ⚠️ 注意事項

1. **正則表達式語法**：使用 Python re 模組的語法
2. **性能考量**：避免過於複雜的正則表達式
3. **測試建議**：新增別名後建議本地測試確認匹配結果
4. **優先級**：精確匹配會覆蓋模式匹配和正則匹配

這樣設計讓「123金」、「234金」、「567金」等所有包含「金」的別名都能正確識別為同一個用戶！🎉